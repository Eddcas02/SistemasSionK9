(this["webpackJsonp@coreui/coreui-free-react-admin-template"]=this["webpackJsonp@coreui/coreui-free-react-admin-template"]||[]).push([[76],{596:function(e,t,a){"use strict";a.d(t,"a",(function(){return n}));const i="".concat("http://34.208.193.210/apipagos/api/","archivosflujo");function n(e,t,a,n,r,c,s,o){let l=i,h="";var d={id_archivoflujo:e,id_flujo:t,id_usuario:a,descripcion:n,archivos:r,nombre_archivo:c,opcion:s,url:"".concat("http://34.208.193.210/pagos/archivos/")};const u=JSON.stringify(d);return""!==e&&""!==s&&(h+="/"+e+"/"+s),l+=h,fetch(l,{method:"POST",body:u,headers:{Authorization:"Bearer "+o,Accept:"application/json","Content-type":"application/json;charset=UTF-8"}}).then((e=>e.json())).then((e=>e)).catch((e=>e))}},917:function(e,t,a){"use strict";a.r(t);var i=a(1),n=a(459),r=a(719),c=a(899),s=a(835),o=a(16),l=a(596),h=a(464),d=(a(460),a(462)),u=a(686),j=a.n(u);a(806);const b=Math.PI/180;var g=async(e,t,a,i=!1)=>{const n=document.createElement("canvas"),r=Math.PI/180,c=e.naturalWidth/e.width,s=e.naturalHeight/e.height,o=window.devicePixelRatio,l=n.getContext("2d");n.width=Math.floor(a.width*c*o),n.height=Math.floor(a.height*s*o),l.scale(o,o),l.imageSmoothingQuality="high";const h=a.x*c,d=a.y*s,u=0*r,j=e.naturalWidth/2,b=e.naturalHeight/2;return l.save(),l.translate(-h,-d),l.translate(j,b),l.rotate(u),l.scale(1,1),l.translate(-j,-b),l.drawImage(e,0,0,e.naturalWidth,e.naturalHeight,0,0,e.naturalWidth,e.naturalHeight),await((e,t,a)=>new Promise(((i,n)=>{e.toBlob((e=>{if(e){let n,r;e.name=t.name,e.lastModified=t.lastModified,a&&(n=URL.createObjectURL(e),r=()=>URL.revokeObjectURL(n)),i({blob:e,blobUrl:n,revokeUrl:r})}else n(new Error("Canvas is empty"))}),t.type)})))(n,t,i)},p=a(685),O=a(10);t.default=()=>{const e=Object(o.g)(),t=Object(o.h)(),{session:a}=Object(n.useSession)("PendrogonIT-Session"),[f,m]=Object(i.useState)(),[v,x]=Object(i.useState)(),w=Object(i.useRef)(),y=Object(i.useRef)(),[S,C]=Object(i.useState)(t.ArchivoOriginal),[A,E]=Object(i.useState)(void 0),[k,I]=Object(i.useState)(1),[P,R]=Object(i.useState)(0),[L,_]=Object(i.useState)([]),[N,T]=Object(i.useState)([]),[H,M]=Object(i.useState)(!1),[U,W]=Object(i.useState)(!1),[z,G]=Object(i.useState)(!0),[D,F]=Object(i.useState)(!0),[B,J]=Object(i.useState)(!1);async function q(){J(!0),W(!1),G(!0),F(!0),setTimeout((()=>{const i=new FormData;let n=function(e){for(var t=[],a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=a.length,n=0;n<e;n++)t.push(a.charAt(Math.floor(Math.random()*i)));return t.join("")}(6)+"_"+t.pago+".pdf",r=function(){const e=new p.a({compress:!0});let t=0;return N.forEach((a=>{t++;var i=new Image;i.src=a;const n=e.getImageProperties(i);let r=e.internal.pageSize.getWidth()-5,c=(e.internal.pageSize.getHeight(),n.height*r/n.width);t>1&&e.addPage(),e.addImage(i,"PNG",-1,0,r,c,"","FAST")})),e.output("blob")}();i.append("image",r),i.append("prefijo",n),fetch("".concat("http://34.208.193.210/pagos/adminpagos-service/","upload.php"),{method:"POST",body:i}).then((function(e){if(200===e.status)return x(null),m(null),_([]),T([]),Object(l.a)(t.id_archivoflujo,t.id_flujo,a.id,"","",n,"2",a.api_token)})).then((function(a){"OK"==a&&e.push({pathname:"/archivoflujo/nuevo",id_flujo:t.id_flujo,pago:t.pago,grupo:t.grupo,estado:t.estado})})).catch((e=>e))}),3e3)}var Q,V,K;return Object(i.useEffect)((()=>{let e=!0;return()=>e=!1}),[]),Q=async()=>{(null===v||void 0===v?void 0:v.width)&&(null===v||void 0===v?void 0:v.height)&&y.current&&w.current&&(v.height>657?(M(!0),W(!0),G(!0),F(!0)):(M(!1),W(!1),N.length>0&&(G(!1),F(!1))),async function(e,t,a,i=1,n=0){const r=t.getContext("2d");if(!r)throw new Error("No 2d context");const c=e.naturalWidth/e.width,s=e.naturalHeight/e.height,o=window.devicePixelRatio;t.width=Math.floor(a.width*c*o),t.height=Math.floor(a.height*s*o),r.scale(o,o),r.imageSmoothingQuality="high";const l=a.x*c,h=a.y*s,d=n*b,u=e.naturalWidth/2,j=e.naturalHeight/2;r.save(),r.translate(-l,-h),r.translate(u,j),r.rotate(d),r.scale(i,i),r.translate(-u,-j),r.drawImage(e,0,0,e.naturalWidth,e.naturalHeight,0,0,e.naturalWidth,e.naturalHeight),r.restore()}(y.current,w.current,v,k,P))},V=100,K=[v,k,P],Object(i.useEffect)((()=>{const e=setTimeout((()=>{Q.apply(void 0,K)}),V);return()=>{clearTimeout(e)}}),K),a?t.id_archivoflujo?Object(O.jsxs)("div",{style:{flexDirection:"row"},children:[Object(O.jsx)("div",{style:{width:"25%",marginLeft:"10px"},children:Object(O.jsxs)(r.a,{variant:"primary",size:"sm",onClick:()=>e.push({pathname:"/archivoflujo/nuevo",id_flujo:t.id_flujo,pago:t.pago,grupo:t.grupo,estado:t.estado}),children:[Object(O.jsx)(h.c,{}),"\xa0\xa0Regresar"]})}),Object(O.jsx)("br",{}),Object(O.jsx)("br",{}),Object(O.jsx)(d.i,{children:Object(O.jsxs)("div",{style:{width:"95%",display:"flex",gap:"10px",justifyContent:"flex-start"},children:[Object(O.jsx)("div",{style:{width:"50%",height:"800px",overflow:"auto"},children:Object(O.jsx)(j.a,{crop:f,onChange:(e,t)=>m(t),onComplete:e=>x(e),aspect:A,children:Object(O.jsx)("img",{ref:y,alt:"Crop me",src:S,style:{transform:"scale(".concat(k,") rotate(").concat(P,"deg)")},onLoad:function(e){if(A){const{width:t,height:a}=e.currentTarget;m(function(e,t,a){return Object(u.centerCrop)(Object(u.makeAspectCrop)({unit:"%",width:90},a,e,t),e,t)}(t,a,A))}}})})}),Object(O.jsxs)("div",{style:{width:"50%"},children:[Object(O.jsx)(r.a,{variant:"success",size:"sm",disabled:U,onClick:()=>{!async function(){var e=new Image;e.src=S,e.crossOrigin="anonymous";const{blob:t,blobUrl:a,revokeUrl:i}=await g(y.current,y.current,v,!0);_([...L,t]),T([...N,a]),G(!1),F(!1)}()},children:"Cortar"})," ",Object(O.jsx)(r.a,{variant:"primary",size:"sm",disabled:z,onClick:()=>{q()},children:"Generar documento"})," ",Object(O.jsx)(r.a,{variant:"danger",size:"sm",disabled:D,onClick:()=>{x(null),m(null),_([]),T([]),G(!0),F(!0)},children:"Limpiar"}),Object(O.jsx)("br",{}),Object(O.jsx)(c.a,{animation:"border",className:B?"":"d-none"}),Object(O.jsx)(s.a,{variant:"danger",className:H?"":"d-none",children:"El \xe1rea seleccionada es m\xe1s grande que una p\xe1gina, por favor seleccione un \xe1rea m\xe1s peque\xf1a."}),Object(O.jsx)("br",{}),Object(O.jsx)("div",{children:Boolean(v)&&Object(O.jsx)("canvas",{ref:w,style:{border:"1px solid black",objectFit:"contain",width:v.width,height:v.height}})}),Object(O.jsx)("div",{style:{height:"400px",overflow:"auto"},children:N.map(((e,t)=>Object(O.jsxs)(O.Fragment,{children:[Object(O.jsxs)("div",{children:[Object(O.jsx)("br",{}),Object(O.jsxs)("div",{style:{display:"flex"},children:[Object(O.jsx)("div",{style:{width:"50%"},children:Object(O.jsxs)("h2",{children:["P\xe1gina ",t+1]},t+1e3)},t+300),Object(O.jsx)("div",{style:{width:"50%"},children:Object(O.jsx)(r.a,{variant:"danger",size:"sm",onClick:()=>{var t;t=e,T([...N.filter((function(e){return e!==t}))])},children:Object(O.jsx)(h.s,{})})},t+400)]},t+200),Object(O.jsx)("br",{}),Object(O.jsx)("img",{src:e,style:{width:"50%"}},t),Object(O.jsx)("br",{})]},t+100),Object(O.jsx)("br",{})]})))})]})]})})]}):(e.goBack(),Object(O.jsx)("div",{className:"sin-sesion",children:"NO SE CARG\xd3 EL C\xd3DIGO DEL ARCHIVO. REGRESE A LA PANTALLA DE PAGOS."})):(e.push("/"),Object(O.jsx)("div",{className:"sin-sesion",children:"SIN SESI\xd3N ACTIVA."}))}}}]);
//# sourceMappingURL=76.423fafa2.chunk.js.map