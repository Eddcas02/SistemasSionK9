{"version":3,"sources":["services/postUsuarioAutorizacion.js","views/components/flujos/autorizacion/UsuarioAutorizacion.js"],"names":["API","process","postUsuarioAutorizacion","idAutorizacion","idAprobador","idTemporal","fechaInicio","fechaFinal","opcion","estado","id_usuario","token","ApiFinal","ApiWhere","datos","id_usuarioautorizacion","id_usuarioaprobador","id_usuariotemporal","fecha_inicio","fecha_final","activo","data","JSON","stringify","fetch","method","body","headers","Authorization","Accept","then","response","json","catch","error","UsuarioGrupo","history","useHistory","location","useLocation","time","setTime","useState","session","clear","useSession","show","setShow","showM","setShowM","mensaje","setMensaje","color","setColor","titulo","setTitulo","results","setList","permisos","setPermisos","registerLocale","es","form","setValues","aprobador","temporal","fechainicio","setFechaInicio","Date","fechafinal","setFechaFinal","useEffect","mounted","idUsuario","id","getUsuarios","api_token","items","users","getPerfilUsuario","detalle","handleInput","event","target","name","value","handleSubmit","async","preventDefault","respuesta","push","Cancelar","postSesionUsuario","deshabilitar","objeto","result","item","ExistePermiso","style","flexDirection","responsive","variant","onHide","centered","Header","closeButton","Title","Body","Footer","onClick","className","marginBottom","size","goBack","onClose","dismissible","Heading","width","onChange","disabled","selected","map","i","eliminado","nombre","apellido","alignItems","marginLeft","marginRight","locale","date","dateFormat"],"mappings":"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","file":"static/js/101.39b1a7fd.chunk.js","sourcesContent":["const API = `${process.env.REACT_APP_API_URL}usuarioautorizacion`\n\nexport function postUsuarioAutorizacion(\n  idAutorizacion,\n  idAprobador,\n  idTemporal,\n  fechaInicio,\n  fechaFinal,\n  opcion,\n  estado,\n  id_usuario,\n  token,\n) {\n  let ApiFinal = API\n  let ApiWhere = ''\n\n  var datos = {\n    id_usuarioautorizacion: idAutorizacion,\n    id_usuarioaprobador: idAprobador,\n    id_usuariotemporal: idTemporal,\n    fecha_inicio: fechaInicio,\n    fecha_final: fechaFinal,\n    opcion: opcion,\n    activo: estado,\n    id_usuario: id_usuario,\n  }\n\n  if (idAutorizacion !== '' && opcion !== '') {\n    ApiWhere += '/' + idAutorizacion + '/' + opcion\n  }\n  ApiFinal += ApiWhere\n\n  const data = JSON.stringify(datos)\n  return fetch(ApiFinal, {\n    method: 'POST',\n    body: data,\n    headers: {\n      Authorization: 'Bearer ' + token,\n      Accept: 'application/json',\n      'Content-type': 'application/json;charset=UTF-8',\n    },\n  })\n    .then((response) => response.json())\n    .then((response) => {\n      return response\n    })\n    .catch((error) => error)\n}\n","import React, { useState, useEffect } from 'react'\nimport { useHistory, useLocation } from 'react-router'\nimport { useIdleTimer } from 'react-idle-timer'\nimport { Alert, Modal, Button } from 'react-bootstrap'\nimport DatePicker, { registerLocale } from 'react-datepicker'\nimport es from 'date-fns/locale/es'\nimport 'react-datepicker/dist/react-datepicker.css'\nimport { useSession } from 'react-use-session'\nimport { postUsuarioAutorizacion } from '../../../../services/postUsuarioAutorizacion'\nimport { postSesionUsuario } from '../../../../services/postSesionUsuario'\nimport { getPerfilUsuario } from '../../../../services/getPerfilUsuario'\nimport { getUsuarios } from '../../../../services/getUsuarios'\nimport '../../../../scss/estilos.scss'\nimport {\n  CButton,\n  CCard,\n  CCardBody,\n  CContainer,\n  CForm,\n  CFormSelect,\n  CFormLabel,\n  CInputGroup,\n  CInputGroupText,\n} from '@coreui/react'\nimport { FaArrowLeft } from 'react-icons/fa'\n\nconst UsuarioGrupo = () => {\n  const history = useHistory()\n  const location = useLocation()\n  const [time, setTime] = useState(null)\n  const { session, clear } = useSession('PendrogonIT-Session')\n  const [show, setShow] = useState(false)\n  const [showM, setShowM] = useState(false)\n  const [mensaje, setMensaje] = useState('')\n  const [color, setColor] = useState('danger')\n  const [titulo, setTitulo] = useState('Error!')\n  const [results, setList] = useState([])\n  const [permisos, setPermisos] = useState([])\n  registerLocale('es', es)\n\n  const [form, setValues] = useState({\n    aprobador: location.id_usuario,\n    temporal: '',\n  })\n\n  const [fechainicio, setFechaInicio] = useState(new Date())\n  const [fechafinal, setFechaFinal] = useState(new Date())\n\n  useEffect(() => {\n    let mounted = true\n    let idUsuario = 0\n    if (session) {\n      idUsuario = session.id\n    }\n    getUsuarios(null, null, null, null, session.api_token).then((items) => {\n      if (mounted) {\n        setList(items.users)\n      }\n    })\n    getPerfilUsuario(idUsuario, '2', null, session.api_token).then((items) => {\n      if (mounted) {\n        setPermisos(items.detalle)\n      }\n    })\n    return () => (mounted = false)\n  }, [])\n\n  function ExistePermiso(objeto) {\n    let result = 0\n    for (let item of permisos) {\n      if (objeto === item.objeto) {\n        result = 1\n      }\n    }\n    return result\n  }\n\n  const handleInput = (event) => {\n    setValues({\n      ...form,\n      [event.target.name]: event.target.value,\n    })\n  }\n\n  const handleSubmit = async (event) => {\n    if (form.aprobador !== '' && form.temporal !== '' && fechainicio && fechafinal) {\n      if (fechafinal > fechainicio) {\n        event.preventDefault()\n        const respuesta = await postUsuarioAutorizacion(\n          '',\n          form.aprobador,\n          form.temporal,\n          fechainicio,\n          fechafinal,\n          '',\n          '',\n          session.id,\n          session.api_token,\n        )\n        if (respuesta === 'OK') {\n          history.push('/autorizacion')\n        } else if (respuesta === 'Existe') {\n          setShow(true)\n          setTitulo('Fechas existentes!')\n          setColor('danger')\n          setMensaje(\n            `Las fechas inicial o final coinciden con una autorizacion ya programada. Intente con otras fechas.`,\n          )\n        }\n      } else {\n        setShow(true)\n        setTitulo('Error!')\n        setColor('danger')\n        setMensaje('La fecha final debe ser después de la inicial.')\n      }\n    } else {\n      setShow(true)\n      setTitulo('Error!')\n      setColor('danger')\n      setMensaje('No has llenado todos los campos.')\n    }\n  }\n\n  async function Cancelar(opcion) {\n    if (opcion == 1) {\n      setShowM(false)\n    } else if (opcion == 2) {\n      let idUsuario = 0\n      if (session) {\n        idUsuario = session.id\n      }\n      const respuesta = await postSesionUsuario(idUsuario, null, null, '2', session.api_token)\n      if (respuesta === 'OK') {\n        clear()\n        history.push('/')\n      }\n    }\n  }\n\n  if (session) {\n    let deshabilitar = false\n    if (ExistePermiso('Modulo Autorizacion') == 0) {\n      deshabilitar = true\n    }\n    return (\n      <div style={{ flexDirection: 'row' }}>\n        <CContainer>\n          <Modal responsive variant=\"primary\" show={showM} onHide={() => Cancelar(2)} centered>\n            <Modal.Header closeButton>\n              <Modal.Title>Confirmación</Modal.Title>\n            </Modal.Header>\n            <Modal.Body>{mensaje}</Modal.Body>\n            <Modal.Footer>\n              <CButton color=\"secondary\" onClick={() => Cancelar(2)}>\n                Cancelar\n              </CButton>\n              <CButton color=\"primary\" onClick={() => Cancelar(1)}>\n                Aceptar\n              </CButton>\n            </Modal.Footer>\n          </Modal>\n          <div className=\"float-left\" style={{ marginBottom: '10px' }}>\n            <Button variant=\"primary\" size=\"sm\" onClick={() => history.goBack()}>\n              <FaArrowLeft />\n              &nbsp;&nbsp;Regresar\n            </Button>\n          </div>\n          <br />\n          <br />\n          <Alert show={show} variant={color} onClose={() => setShow(false)} dismissible>\n            <Alert.Heading>{titulo}</Alert.Heading>\n            <p>{mensaje}</p>\n          </Alert>\n          <CCard className=\"autorizacion-card\">\n            <CCardBody style={{ width: '80%' }}>\n              <CForm className=\"autorizacion-form\">\n                <h1>Asignación de Usuario Temporal</h1>\n                <p className=\"text-medium-emphasis autorizacion-form\">\n                  Seleccione a un nuevo encargado\n                </p>\n                <CInputGroup className=\"mb-3 autorizacion-form\">\n                  <CInputGroupText style={{ width: '22%' }}>Usuario Aprobador</CInputGroupText>\n                  <CFormSelect name=\"aprobador\" onChange={handleInput} disabled={deshabilitar}>\n                    <option selected={true} value={session.id}>\n                      {session.name}\n                    </option>\n                    {results.map((item, i) => {\n                      if (item.eliminado == 0 && item.activo == 1) {\n                        return (\n                          <option key={item.id} value={item.id}>\n                            {item.nombre} {item.apellido}\n                          </option>\n                        )\n                      }\n                    })}\n                  </CFormSelect>\n                </CInputGroup>\n                <CInputGroup className=\"mb-3 autorizacion-form\">\n                  <CInputGroupText style={{ width: '22%' }}>Usuario Temporal</CInputGroupText>\n                  <CFormSelect name=\"temporal\" onChange={handleInput}>\n                    <option>Seleccione usuario temporal.</option>\n                    {results.map((item, i) => {\n                      if (item.eliminado == 0 && item.activo == 1 && item.id !== session.id) {\n                        return (\n                          <option key={item.id} value={item.id}>\n                            {item.nombre} {item.apellido}\n                          </option>\n                        )\n                      }\n                    })}\n                  </CFormSelect>\n                </CInputGroup>\n                <div style={{ width: '100%', alignItems: 'center' }}>\n                  <div className=\"autorizacion-fecha\">\n                    <div style={{ width: '100%', alignItems: 'center' }}>\n                      <CFormLabel style={{ marginLeft: '40px', marginRight: '15px' }}>\n                        Fecha de Inicio\n                      </CFormLabel>\n                      <DatePicker\n                        locale=\"es\"\n                        selected={fechainicio}\n                        onChange={(date) => setFechaInicio(date)}\n                        dateFormat=\"dd-MMMM-yyyy\"\n                      />\n                    </div>\n                    <div style={{ width: '50%', alignItems: 'center' }}>\n                      <CFormLabel style={{ marginLeft: '40px', marginRight: '15px' }}>\n                        Fecha de Fin\n                      </CFormLabel>\n                      <DatePicker\n                        locale=\"es\"\n                        selected={fechafinal}\n                        onChange={(date) => setFechaFinal(date)}\n                        dateFormat=\"dd-MMMM-yyyy\"\n                      />\n                    </div>\n                  </div>\n                </div>\n                <br />\n                <CButton color=\"primary\" onClick={handleSubmit} style={{ marginBottom: '20px' }}>\n                  Guardar Cambios\n                </CButton>\n              </CForm>\n            </CCardBody>\n          </CCard>\n        </CContainer>\n      </div>\n    )\n  } else {\n    history.push('/')\n    return <div className=\"sin-sesion\">SIN SESIÓN ACTIVA.</div>\n  }\n}\n\nexport default UsuarioGrupo\n"],"sourceRoot":""}